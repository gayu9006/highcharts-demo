<div class="container mt-4">
  <h2 class="text-center mb-4">Visitor Analytics Dashboard</h2>

  <div class="d-flex justify-content-center">
    <div
      class="filter-bar d-flex flex-wrap justify-content-center align-items-center gap-4 mb-4"
    >
      <!-- Day Selector -->
      <div class="filter-card px-3 py-2 shadow-sm rounded-3 bg-white">
        <label for="daySelect" class="form-label fw-semibold mb-1 text-primary">
          <i class="bi bi-calendar3 me-1"></i> Select Day
        </label>
        <select
          id="daySelect"
          class="form-select form-select-sm border-primary"
          (change)="onDayChange($any($event.target).value)"
        >
          <option *ngFor="let d of data" [value]="d.dayOfWeek">
            {{ d.dayOfWeek }}
          </option>
        </select>
      </div>

      <!-- Chart Type Selector -->
      <div class="filter-card px-3 py-2 shadow-sm rounded-3 bg-white">
        <label class="form-label fw-semibold mb-1 text-success">
          <i class="bi bi-bar-chart-line me-1"></i> Chart Type
        </label>
        <select
          class="form-select form-select-sm border-success"
          [(ngModel)]="selectedChartType"
          (change)="changeChartType()"
        >
          <option value="column">Column</option>
          <option value="line">Line</option>
          <option value="pie">Pie</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Chart -->
  <div class="card p-3 shadow-sm mb-4">
    <highcharts-chart
      *ngIf="chartOptions && chartOptions.series"
      [Highcharts]="Highcharts"
      [options]="chartOptions"
      style="width: 100%; height: 400px; display: block"
    ></highcharts-chart>
  </div>

  <!-- Summary -->
  <div
    *ngIf="selectedDay"
    class="alert alert-info text-center fw-semibold shadow-sm"
  >
    <strong>{{ selectedDay?.dayOfWeek }}</strong> had
    <strong>{{ selectedDay?.visitorCounts }}</strong> total visitors.
  </div>

  <!-- Table -->
  <div class="card p-3 shadow-sm mt-4">
    <h5 class="mb-3 text-center">
      Hourly Visitor Data ({{ selectedDay?.dayOfWeek }})
    </h5>

    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-primary">
          <tr>
            <th style="width: 5%">#</th>
            <th style="width: 20%">Hour</th>
            <th style="width: 25%">Visitor Count</th>
            <th style="width: 25%">% of Day Total</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let h of selectedDay?.hours; let i = index"
            [ngClass]="{
              'table-danger fw-semibold': getPercent(h.visitorCounts) > 15
            }"
          >
            <td>{{ i + 1 }}</td>
            <td>{{ h.hour }}</td>
            <td>{{ h.visitorCounts }}</td>
            <td>
              {{ getPercent(h.visitorCounts) | number: '1.0-1' }}%
            </td>
          </tr>
        </tbody>
        <tfoot class="table-light fw-bold">
          <tr>
            <td colspan="2" class="text-end">Total Visitors:</td>
            <td>{{ selectedDay?.visitorCounts }}</td>
            <td>100%</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
